\section{WiFi protocol and security}

\question{Power saving mode in 802.11 + attack}

\question{Consider a setup in which 2 STA (STA-1 and STA-2) are connected to the same WLAN managed by an AP. A third device (ETH-1) is connected with Ethernet technology. For each setup, describe and justify the expected goodput in the following cases:
    \begin{parts}
        \part Scenario 1 (3 points): Both STA-1 and STA-2 use 802.11g on the ISM band. ETH-1 uses Fast Ethernet
        technology with a physical link capacity of 100Mb/s
        \begin{enumerate}
            \item STA-1 sends data to ETH-1 using UDP
            \item STA-1 sends data to ETH-1 using TCP
            \item STA-1 sends data to STA-2 using UDP
            \item STA-1 sends data to STA-2 using TCP
        \end{enumerate}

        \part Scenario 2 (2 points): What changes if STA-1 now connects to the same WLAN but using the 5GHz band?
        Again, consider the cases
        \begin{enumerate}
            \item STA-1 sends data to ETH-1 using UDP
            \item STA-1 sends data to ETH-1 using TCP
            \item STA-1 sends data to STA-2 using UDP
            \item STA-1 sends data to STA-2 using TCP
        \end{enumerate}

        \part Scenario 3 (1 point): what changes if now both STA-1 (on 5GHz band) and STA-2 (on 2.4GHz band) upgrade their technology to using 802.11ax (WiFi 6)?
        \begin{enumerate}
            \item STA-1 sends data to ETH-1 using UDP
            \item STA-1 sends data to ETH-1 using TCP
            \item STA-1 sends data to STA-2 using UDP
            \item STA-1 sends data to STA-2 using TCP
        \end{enumerate}
    \end{parts}
    Consider UDP header of 8B, TCP header of 20B, IP header of 20B, Ethernet header of 38B.
}

\question{Consider a setup in which 2 STA (STA-1 and STA-2) are connected to the same WLAN managed by an AP. A third device (ETH-1) is connected with Ethernet technology. For each setup, describe and justify the expected goodput in the following cases:
\begin{parts}
    \part[3] Scenario 1: Both STA-1 and STA-2 use 802.11g on the ISM band. ETH-1 uses Gigabit Ethernet technology with a physical link capacity of 1000Mb/s
    \begin{enumerate}
        \item ETH-1 sends data to STA-1 using UDP
        \item ETH-1 sends data to STA-1 using TCP
        \item ETH-1 sends data to STA-1 and STA-2 at the same time using UDP
        \item ETH-1 sends data to STA-1 and STA-2 at the same time using TCP
    \end{enumerate}

    \part[2] Scenario 2: What changes if STA-1 now connects to the same WLAN but using the 5GHz band? Again, consider the cases
    \begin{enumerate}
        \item ETH-1 sends data to STA-1 using UDP
        \item ETH-1 sends data to STA-1 using TCP
        \item ETH-1 sends data to STA-1 and STA-2 at the same time using UDP
        \item ETH-1 sends data to STA-1 and STA-2 at the same time using TCP
    \end{enumerate}

    \part[1] Scenario 3: what changes if now both STA-1 (on 5GHz band) and STA-2 (on 2.4GHz band) upgrade their technology to using 802.11ax (WiFi 6) with maximum data rate of 1.1Gb/s each?
    \begin{enumerate}
        \item ETH-1 sends data to STA-1 using UDP
        \item ETH-1 sends data to STA-1 using TCP
        \item ETH-1 sends data to STA-1 and STA-2 at the same time using UDP
        \item ETH-1 sends data to STA-1 and STA-2 at the same time using TCP
    \end{enumerate}
\end{parts}

Consider UDP header of 8B, TCP header of 20B, IP header of 20B, Ethernet header of 38B. Consider the maximum efficiency of WiFi-6 to be 80\% on MTU frames.
}

\begin{solution}
    % cmljY2FyZG9yb3Npbg==, corrected
    This solution got 6/6 points.

    Scenario 1:
    Considering:
    \begin{align*}
    \text{UDP-over-ETH efficiency} &= \frac{1500_{\text{MTU}} - 20_{\text{IP}} - 8_{\text{UDP}}}{1500_{\text{MTU}} + 38_{\text{ETH}}} = 0.956 \\
    \text{TCP-over-ETH efficiency} &= \frac{1500_{\text{MTU}} - 20_{\text{IP}} - 20_{\text{TCP}}}{1500_{\text{MTU}} + 38_{\text{ETH}}} = 0.949
    \end{align*}
    Generic 802.11g efficiency: 50\% (TCP), 55\% (UDP). \\
    ETH maximum throughput: 1000 Mbps. \\
    802.11g maximum throughput: 54 Mbps.
    \begin{enumerate}
        \item The maximum throughput is limited by the 802.11g link (54 Mbps < 1000 Mbps). Considering an efficiency of 0.55, expected goodput is 29.7 Mbps.
        \item The maximum throughput is limited by the 802.11g link (54 Mbps < 1000 Mbps). Considering an efficiency of 0.5 (lower than UDP due to acknowledgements and possible retransmissions), expected goodput is 27 Mbps.
        \item The maximum throughput is limited by the 802.11g link (54 Mbps < 1000 Mbps). We need to consider channel sharing for two STAs, so actual throughput for each STA is ~27 Mbps. With efficiency 0.55, expected goodput is 14.85 Mbps.
        \item The maximum throughput is limited by the 802.11g link (54 Mbps < 1000 Mbps). We need to consider channel sharing for two STAs, so actual throughput for each STA is ~27 Mbps. With efficiency 0.5, expected goodput is 13.5 Mbps.
    \end{enumerate}

    Scenario 2:
    In 802.11g, the maximum theoretical throughput is still 54 Mbps on the 5 GHz band (600 Mbps on the 5 GHz band if using 802.11n).
    Considering the same efficiency values as in Scenario 1:
    \begin{enumerate}
        \item Max throughput 54 Mbps, expected goodput 29.7 Mbps.
        \item Max throughput 54 Mbps, expected goodput 27 Mbps.
        \item Max throughput 54 Mbps, but no channel sharing as the two STAs are using different frequency bands. Expected goodput 29.7 Mbps.
        \item Max throughput 54 Mbps, but no channel sharing as the two STAs are using different frequency bands. Expected goodput 27 Mbps.
    \end{enumerate}

    Scenario 3:
    (Considering WiFi 6 efficiency of 0.8)
    \begin{enumerate}
        \item Considering ETH throughput being reduced to 956 Mbps and WiFi 6 throughput reduced to 1100 Mbps * 0.80 = 880 Mbps, expected goodput is going to be 880 Mbps.
        \item Considering ETH throughput being reduced to 949 Mbps and WiFi 6 throughput reduced to 1100 Mbps * 0.80 = 880 Mbps, expected goodput is going to be 880 Mbps.
        \item As the two STAs are on different frequency bands, the wireless link is not shared, allowing each STA to use its maximum capacity. The Ethernet link must be shared instead, ~1000 Mbps/2 = 500 Mbps. So expected goodput is 500 Mbps * 0.956 = 478 Mbps.
        \item As the two STAs are on different frequency bands, the wireless link is not shared, allowing each STA to use its maximum capacity. The Ethernet link must be shared instead, ~1000 Mbps/2 = 500 Mbps. So expected goodput is 500 Mbps * 0.949 = 474.5 Mbps.
    \end{enumerate}
\end{solution}


\question{Describe the frames exchanged by an STA and an AP to inform the STA about the SSID of the AP; what kind of attack exploits this mechanism?}

\question{Describe step For OPEN AUTH system when the AP communicates ESSID and when not}

\question{Describe the sequence of messages that an STA and an AP exchange during association and authentication processes in an open system in the following cases:
    \begin{parts}
        \part Case 1 - AP broadcasts beacon messages (2 points)
        \begin{enumerate}
            \item STA does XXX
            \item AP responds with YYY
            \item STA processes ZZZ
            \item Attack types: ABC
        \end{enumerate}

        \part Case 2 - ESSID is hidden, AP does not broadcast WLAN EISS in beacons (2 points)
        \begin{enumerate}
            \item STA does XXX
            \item AP responds with YYY
            \item STA processes ZZZ
            \item Attack types: ABC
        \end{enumerate}
    \end{parts}
}

\question{Describe and sketch the sequences of messages an STA and an AP exchange during the initial Association and Authentication process in an Open System. Consider both the case in which
    \begin{parts}
        \part[2] Case 1 - The AP broadcasts the beacon messages
        \begin{enumerate}
            \item STA sends frame XXX to AP
            \item AP broadcasts frame YYY
            \item STA extracts ZZZ from YYY and computes KKK
            \item Attack types: ABC
        \end{enumerate}

        \part[2] Case 2 - The ESSID is hidden and the AP does not broadcast the WLAN ESSIS in the beacons
        \begin{enumerate}
            \item STA sends frame XXX to AP
            \item AP broadcasts frame YYY
            \item STA extracts ZZZ from YYY and computes KKK
            \item Attack types: ABC
        \end{enumerate}
    \end{parts}
}

\question{Describe the 802.11 power management capabilities (4 points) 

How can an STA tell the AP that it is going to sleep? 

For how long would the AP not be able to transmit frames to a sleeping STA? 

How can the AP tell the STA that it has some buffered frames waiting to be sent? 

Describe with an example the sequence of frames exchanged over a time between the STA and the AP. You can use a numbered list and state who sends what to who, or which computations a device does with some information: 
\begin{enumerate}
    \item STA sends frame XXX to AP 
    \item AP sends frame YYY to broadcast 
    \item STA extracts ZZZ from YYY and computes KKK, YYY, LLL 
    \item ...
\end{enumerate}

How can an attacker abuse of these mechanisms to mount a DoS attacks? (2 points)}

